# Filerestore_CLI ä»£ç ç»Ÿè®¡æŠ¥å‘Š

> ç”Ÿæˆæ—¥æœŸ: 2025-01-05
> é¡¹ç›®ç‰ˆæœ¬: v1.0 (åŸºäºæœ€æ–°commit)

## æ¦‚è§ˆ

| ç»Ÿè®¡é¡¹ | æ•°å€¼ |
|--------|------|
| **æ€»ä»£ç è¡Œæ•°** | 16,603 è¡Œ |
| **æºæ–‡ä»¶æ•°é‡** | 53 ä¸ª (.cpp + .h) |
| **ä¸»è¦æ¨¡å—æ•°** | 5 ä¸ª |
| **æ ¸å¿ƒåŠŸèƒ½ç±»** | 18 ä¸ª |

---

## æ¨¡å—ä»£ç åˆ†å¸ƒ

```
FileRestore (68.5%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  11,370 è¡Œ
Commands    (19.5%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                             3,234 è¡Œ
Utils       (5.7%)   â–ˆâ–ˆâ–ˆ                                      948 è¡Œ
Core        (3.9%)   â–ˆâ–ˆ                                       652 è¡Œ
Analysis    (2.3%)   â–ˆ                                        378 è¡Œ
Other       (0.1%)   Â·                                         21 è¡Œ
```

---

## ä¸€ã€æ ¸å¿ƒæ¨¡å— (Core) - 652 è¡Œ

CLIæ¡†æ¶å’Œå…¥å£ç‚¹

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| Main.cpp | 102 | ç¨‹åºå…¥å£ï¼Œåˆå§‹åŒ– |
| cli.cpp | 304 | CLIä¸»å¾ªç¯ï¼Œå‘½ä»¤åˆ†å‘ |
| cli.h | 43 | CLIç±»å®šä¹‰ |
| climodule.cpp | 157 | æ¨¡å—åŠ è½½ç®¡ç† |
| climodule.h | 46 | æ¨¡å—æ¥å£å®šä¹‰ |

---

## äºŒã€å‘½ä»¤æ¨¡å— (Commands) - 3,234 è¡Œ

æ‰€æœ‰ç”¨æˆ·å‘½ä»¤çš„å®ç°

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| **cmd.cpp** | **2,931** | æ‰€æœ‰å‘½ä»¤å®ç°ï¼ˆæœ€å¤§æ–‡ä»¶ï¼‰ |
| cmd.h | 143 | å‘½ä»¤ç±»å£°æ˜ |
| CommandMacros.h | 160 | å‘½ä»¤æ³¨å†Œå®å®šä¹‰ |

### åŒ…å«çš„å‘½ä»¤ (26ä¸ª)

**æ–‡ä»¶æ¢å¤å‘½ä»¤ (3ä¸ª)**
- `restorebyrecord` - æŒ‰MFTè®°å½•å·æ¢å¤
- `forcerestore` - å¼ºåˆ¶æ¢å¤ï¼ˆè·³è¿‡æ£€æµ‹ï¼‰
- `batchrestore` - æ‰¹é‡æ¢å¤

**æ–‡ä»¶æœç´¢å‘½ä»¤ (6ä¸ª)**
- `listdeleted` - åˆ—å‡ºå·²åˆ é™¤æ–‡ä»¶
- `searchdeleted` - æœç´¢å·²åˆ é™¤æ–‡ä»¶
- `searchusn` - USNæ—¥å¿—æœç´¢
- `filtersize` - æŒ‰å¤§å°ç­›é€‰
- `finduserfiles` - æŸ¥æ‰¾ç”¨æˆ·æ–‡ä»¶
- `findrecord` / `diagnosefile`

**ç­¾åæœç´¢å‘½ä»¤ (7ä¸ª)**
- `carve` - ç­¾åæ‰«æï¼ˆå¼‚æ­¥I/Oï¼‰
- `carvepool` - çº¿ç¨‹æ± æ‰«æ
- `carvetypes` - æ”¯æŒçš„ç±»å‹åˆ—è¡¨
- `carvelist` - ç»“æœåˆ†é¡µæµè§ˆ
- `carverecover` - æ¢å¤carvedæ–‡ä»¶
- `carvevalidate` / `carveintegrity` - å®Œæ•´æ€§éªŒè¯

**ç³»ç»Ÿå‘½ä»¤ (5ä¸ª+)**
- `help` / `exit` / `setlang` / `printallcommand` / `printallfunc` ç­‰

---

## ä¸‰ã€æ–‡ä»¶æ¢å¤æ¨¡å— (FileRestore) - 11,370 è¡Œ

é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½ï¼Œå æ€»ä»£ç é‡68.5%

### 3.1 MFTè¯»å–å±‚ - 2,081 è¡Œ

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| MFTReader.cpp | 637 | åº•å±‚MFTè¯»å–ï¼Œç°‡æ“ä½œ |
| MFTReader.h | 89 | - |
| MFTParser.cpp | 560 | MFTè®°å½•è§£æï¼Œå±æ€§æå– |
| MFTParser.h | 32 | - |
| MFTBatchReader.cpp | 165 | æ‰¹é‡è¯»å–+LRUç¼“å­˜ |
| MFTBatchReader.h | 64 | - |
| MFTStructures.h | 137 | NTFSç»“æ„å®šä¹‰ |
| PathResolver.cpp | 382 | è·¯å¾„é‡å»º |
| PathResolver.h | 63 | - |

### 3.2 æ–‡ä»¶æ¢å¤å±‚ - 1,256 è¡Œ

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| FileRestore.cpp | 271 | æ¢å¤æµç¨‹åè°ƒ |
| FileRestore.h | 59 | - |
| DeletedFileScanner.cpp | 861 | åˆ é™¤æ–‡ä»¶æ‰«æï¼Œç¼“å­˜ç®¡ç† |
| DeletedFileScanner.h | 65 | - |

### 3.3 è¦†ç›–æ£€æµ‹å±‚ - 1,614 è¡Œ

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| OverwriteDetector.cpp | 1,251 | å¤šæ¨¡å¼è¦†ç›–æ£€æµ‹ |
| OverwriteDetector.h | 147 | - |
| OverwriteDetectionThreadPool.cpp | 149 | å¤šçº¿ç¨‹æ£€æµ‹ |
| OverwriteDetectionThreadPool.h | 67 | - |

### 3.4 USNæ—¥å¿— - 562 è¡Œ

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| UsnJournalReader.cpp | 452 | USNæ—¥å¿—è¯»å–ä¸æœç´¢ |
| UsnJournalReader.h | 110 | - |

### 3.5 ç­¾åæœç´¢ (File Carving) - 4,824 è¡Œ

è¿™æ˜¯æœ€å¤æ‚çš„å­æ¨¡å—ï¼Œå FileRestoreçš„42%

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| **FileCarver.cpp** | **1,886** | ç­¾åæ‰«ææ ¸å¿ƒï¼ˆç¬¬äºŒå¤§æ–‡ä»¶ï¼‰ |
| FileCarver.h | 301 | - |
| CarvedFileTypes.h | 60 | ç±»å‹å®šä¹‰ |
| SignatureScanThreadPool.cpp | 547 | çº¿ç¨‹æ± å¹¶è¡Œæ‰«æ |
| SignatureScanThreadPool.h | 195 | - |
| MFTLCNIndex.cpp | 366 | LCNåˆ°MFTç´¢å¼• |
| MFTLCNIndex.h | 70 | - |
| TimestampExtractor.cpp | 532 | å…ƒæ•°æ®æ—¶é—´æˆ³æå– |
| TimestampExtractor.h | 60 | - |
| FileIntegrityValidator.cpp | 685 | æ–‡ä»¶å®Œæ•´æ€§éªŒè¯ |
| FileIntegrityValidator.h | 149 | - |

### 3.6 å¤§æ•°æ®é›†ä¼˜åŒ– - 958 è¡Œ

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| CarvedResultsCache.cpp | 413 | ç»“æœæŒä¹…åŒ–ç¼“å­˜ |
| CarvedResultsCache.h | 75 | - |
| MemoryMappedResults.cpp | 398 | å†…å­˜æ˜ å°„å¤§ç»“æœé›† |
| MemoryMappedResults.h | 72 | - |

---

## å››ã€å·¥å…·æ¨¡å— (Utils) - 948 è¡Œ

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| Logger.cpp | 272 | æ—¥å¿—ç³»ç»Ÿ |
| Logger.h | 115 | - |
| LocalizationManager.cpp | 187 | å›½é™…åŒ–æ”¯æŒ |
| LocalizationManager.h | 70 | - |
| ProgressBar.cpp | 119 | è¿›åº¦æ¡æ˜¾ç¤º |
| ProgressBar.h | 44 | - |
| CrashHandler.cpp | 116 | å´©æºƒå¤„ç† |
| CrashHandler.h | 25 | - |

---

## äº”ã€åˆ†ææ¨¡å— (Analysis) - 378 è¡Œ

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| ImageTable.cpp | 339 | PEæ–‡ä»¶åˆ†æï¼ˆå¯¼å…¥è¡¨ï¼‰ |
| ImageTable.h | 39 | - |

---

## å…­ã€å…¶ä»– - 21 è¡Œ

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| Filerestore_CLI.cpp | 21 | VSç”Ÿæˆçš„å­˜æ ¹æ–‡ä»¶ |

---

## å¤æ‚åº¦åˆ†æ

### æœ€å¤§æ–‡ä»¶ TOP 5

| æ’å | æ–‡ä»¶ | è¡Œæ•° | å æ¯” |
|------|------|------|------|
| 1 | cmd.cpp | 2,931 | 17.7% |
| 2 | FileCarver.cpp | 1,886 | 11.4% |
| 3 | OverwriteDetector.cpp | 1,251 | 7.5% |
| 4 | DeletedFileScanner.cpp | 861 | 5.2% |
| 5 | FileIntegrityValidator.cpp | 685 | 4.1% |

### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CLI Layer (cmd.cpp)                â”‚  ç”¨æˆ·äº¤äº’
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Coordinator (FileRestore)              â”‚  æµç¨‹åè°ƒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   MFT Scanning    â”‚       File Carving              â”‚  æ‰«æå¼•æ“
â”‚   (DeletedFile    â”‚   (FileCarver + ThreadPool)     â”‚
â”‚    Scanner)       â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   MFT Reading     â”‚   Validation & Timestamp        â”‚  æ•°æ®å¤„ç†
â”‚  (MFTReader/      â”‚  (IntegrityValidator,           â”‚
â”‚   Parser/Batch)   â”‚   TimestampExtractor)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Storage (Cache + MemoryMapped)         â”‚  æŒä¹…åŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é‡æ„å»ºè®®

### 1. cmd.cpp æ‹†åˆ† (ä¼˜å…ˆçº§ï¼šé«˜)

å½“å‰ `cmd.cpp` åŒ…å«æ‰€æœ‰26ä¸ªå‘½ä»¤çš„å®ç°ï¼Œå»ºè®®æ‹†åˆ†ä¸ºï¼š

```
src/commands/
â”œâ”€â”€ cmd.cpp           â†’ ä¿ç•™åŸºç¡€æ¡†æ¶
â”œâ”€â”€ RestoreCommands.cpp    (~500è¡Œ) æ¢å¤ç›¸å…³å‘½ä»¤
â”œâ”€â”€ SearchCommands.cpp     (~600è¡Œ) æœç´¢ç›¸å…³å‘½ä»¤
â”œâ”€â”€ CarveCommands.cpp      (~1200è¡Œ) ç­¾åæœç´¢å‘½ä»¤
â””â”€â”€ SystemCommands.cpp     (~400è¡Œ) ç³»ç»Ÿå‘½ä»¤
```

### 2. FileCarver ç®€åŒ– (ä¼˜å…ˆçº§ï¼šä¸­)

`FileCarver.cpp` (1,886è¡Œ) å¯æå–ï¼š
- å¼‚æ­¥I/Oé€»è¾‘ â†’ `AsyncIOScanner.cpp`
- åˆ é™¤çŠ¶æ€æ£€æŸ¥ â†’ ç§»è‡³ç°æœ‰ `MFTLCNIndex`
- æ—¶é—´æˆ³é›†æˆé€»è¾‘ â†’ `TimestampExtractor` å¢å¼º

### 3. ç»Ÿä¸€ç¼“å­˜ç­–ç•¥ (ä¼˜å…ˆçº§ï¼šä¸­)

å½“å‰å­˜åœ¨å¤šä¸ªç¼“å­˜å®ç°ï¼š
- `DeletedFileScanner` çš„æ–‡ä»¶ç¼“å­˜
- `MFTBatchReader` çš„LRUç¼“å­˜
- `CarvedResultsCache` ç»“æœç¼“å­˜
- `PathResolver` è·¯å¾„ç¼“å­˜

å»ºè®®ï¼šåˆ›å»ºç»Ÿä¸€çš„ `CacheManager` ç±»

### 4. æµ‹è¯•è¦†ç›– (ä¼˜å…ˆçº§ï¼šé«˜)

å½“å‰æ— æµ‹è¯•ä»£ç ï¼Œå»ºè®®æ·»åŠ ï¼š
- å•å…ƒæµ‹è¯• (MFTè§£æã€ç­¾ååŒ¹é…)
- é›†æˆæµ‹è¯• (æ¢å¤æµç¨‹)

---

## ç‰ˆæœ¬ç®¡ç†å»ºè®®

### æ¨¡å—åŒ–ç‰ˆæœ¬å·

```
v1.0.0
  â”‚ â”‚ â””â”€â”€ ä¿®å¤ç‰ˆæœ¬ (Bug fixes)
  â”‚ â””â”€â”€â”€â”€ åŠŸèƒ½ç‰ˆæœ¬ (New features)
  â””â”€â”€â”€â”€â”€â”€ ä¸»ç‰ˆæœ¬ (Breaking changes)
```

### å»ºè®®çš„é‡Œç¨‹ç¢‘

- **v1.1**: cmd.cpp æ‹†åˆ† + æµ‹è¯•æ¡†æ¶
- **v1.2**: ç¼“å­˜ç»Ÿä¸€ + æ€§èƒ½ä¼˜åŒ–
- **v2.0**: GUIæ”¯æŒ / è·¨å¹³å°

---

## é™„å½•ï¼šå®Œæ•´æ–‡ä»¶åˆ—è¡¨

<details>
<summary>ç‚¹å‡»å±•å¼€ 53 ä¸ªæºæ–‡ä»¶</summary>

### .cpp æ–‡ä»¶ (26ä¸ª)
| # | æ–‡ä»¶è·¯å¾„ | è¡Œæ•° |
|---|----------|------|
| 1 | src/core/Main.cpp | 102 |
| 2 | src/core/cli.cpp | 304 |
| 3 | src/core/climodule.cpp | 157 |
| 4 | src/commands/cmd.cpp | 2,931 |
| 5 | src/analysis/ImageTable.cpp | 339 |
| 6 | src/utils/Logger.cpp | 272 |
| 7 | src/utils/CrashHandler.cpp | 116 |
| 8 | src/utils/LocalizationManager.cpp | 187 |
| 9 | src/utils/ProgressBar.cpp | 119 |
| 10 | src/fileRestore/MFTReader.cpp | 637 |
| 11 | src/fileRestore/MFTParser.cpp | 560 |
| 12 | src/fileRestore/FileRestore.cpp | 271 |
| 13 | src/fileRestore/DeletedFileScanner.cpp | 861 |
| 14 | src/fileRestore/MFTBatchReader.cpp | 165 |
| 15 | src/fileRestore/OverwriteDetector.cpp | 1,251 |
| 16 | src/fileRestore/PathResolver.cpp | 382 |
| 17 | src/fileRestore/UsnJournalReader.cpp | 452 |
| 18 | src/fileRestore/SignatureScanThreadPool.cpp | 547 |
| 19 | src/fileRestore/TimestampExtractor.cpp | 532 |
| 20 | src/fileRestore/FileCarver.cpp | 1,886 |
| 21 | src/fileRestore/MFTLCNIndex.cpp | 366 |
| 22 | src/fileRestore/FileIntegrityValidator.cpp | 685 |
| 23 | src/fileRestore/CarvedResultsCache.cpp | 413 |
| 24 | src/fileRestore/MemoryMappedResults.cpp | 398 |
| 25 | src/fileRestore/OverwriteDetectionThreadPool.cpp | 149 |
| 26 | Filerestore_CLI.cpp | 21 |

### .h æ–‡ä»¶ (27ä¸ª)
| # | æ–‡ä»¶è·¯å¾„ | è¡Œæ•° |
|---|----------|------|
| 1 | src/core/cli.h | 43 |
| 2 | src/core/climodule.h | 46 |
| 3 | src/commands/cmd.h | 143 |
| 4 | src/commands/CommandMacros.h | 160 |
| 5 | src/analysis/ImageTable.h | 39 |
| 6 | src/utils/Logger.h | 115 |
| 7 | src/utils/CrashHandler.h | 25 |
| 8 | src/utils/LocalizationManager.h | 70 |
| 9 | src/utils/ProgressBar.h | 44 |
| 10 | src/fileRestore/MFTReader.h | 89 |
| 11 | src/fileRestore/MFTParser.h | 32 |
| 12 | src/fileRestore/FileRestore.h | 59 |
| 13 | src/fileRestore/DeletedFileScanner.h | 65 |
| 14 | src/fileRestore/MFTBatchReader.h | 64 |
| 15 | src/fileRestore/OverwriteDetector.h | 147 |
| 16 | src/fileRestore/PathResolver.h | 63 |
| 17 | src/fileRestore/UsnJournalReader.h | 110 |
| 18 | src/fileRestore/SignatureScanThreadPool.h | 195 |
| 19 | src/fileRestore/TimestampExtractor.h | 60 |
| 20 | src/fileRestore/MFTStructures.h | 137 |
| 21 | src/fileRestore/FileCarver.h | 301 |
| 22 | src/fileRestore/CarvedFileTypes.h | 60 |
| 23 | src/fileRestore/MFTLCNIndex.h | 70 |
| 24 | src/fileRestore/FileIntegrityValidator.h | 149 |
| 25 | src/fileRestore/CarvedResultsCache.h | 75 |
| 26 | src/fileRestore/MemoryMappedResults.h | 72 |
| 27 | src/fileRestore/OverwriteDetectionThreadPool.h | 67 |

</details>

---

## å…«ã€è·¨å¹³å°ç§»æ¤åˆ†æ

> æ›´æ–°æ—¥æœŸ: 2025-01-06

### 8.1 C++ è·¨å¹³å°é€‚ç”¨æ€§è¯„ä¼°

#### âœ… C++ çš„ä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **åº•å±‚è®¿é—®èƒ½åŠ›** | å¯ç›´æ¥æ“ä½œç£ç›˜æ‰‡åŒºã€å†…å­˜æ˜ å°„ |
| **æ€§èƒ½ä¼˜å¼‚** | æ–‡ä»¶ç³»ç»Ÿæ“ä½œå¯¹æ€§èƒ½æ•æ„Ÿï¼ŒC++ æ—  GC å¼€é”€ |
| **æˆç†Ÿçš„è·¨å¹³å°åº“** | Boostã€Qtã€POSIX API æ”¯æŒè‰¯å¥½ |
| **ç³»ç»Ÿç¼–ç¨‹é¦–é€‰** | Linux/macOS å†…æ ¸ã€æ–‡ä»¶ç³»ç»Ÿå·¥å…·å¤šç”¨ C/C++ |
| **ç°æœ‰ä»£ç å¯å¤ç”¨** | ç®—æ³•é€»è¾‘ï¼ˆç†µè®¡ç®—ã€ç­¾ååŒ¹é…ï¼‰å¯ç›´æ¥ç§»æ¤ |

#### âš ï¸ C++ çš„æŒ‘æˆ˜

| æŒ‘æˆ˜ | è¯´æ˜ |
|------|------|
| **æ— ç»Ÿä¸€æ–‡ä»¶ç³»ç»Ÿ API** | éœ€ä¸ºæ¯ä¸ªå¹³å°å®ç°æŠ½è±¡å±‚ |
| **å¹³å°ç±»å‹å·®å¼‚** | Windows: `HANDLE`, `DWORD` vs POSIX: `int`, `size_t` |
| **å­—èŠ‚åºé—®é¢˜** | x86 å°ç«¯åºï¼Œéœ€å¤„ç†å¤§ç«¯åºå¹³å° |
| **è·¯å¾„åˆ†éš”ç¬¦** | Windows: `\` vs Unix: `/` |

#### ğŸ¯ ç»“è®ºï¼šC++ æ˜¯åˆé€‚çš„é€‰æ‹©

æ¨èä½¿ç”¨ **C++17** æˆ–æ›´é«˜ç‰ˆæœ¬ï¼š
- `std::filesystem` ç»Ÿä¸€è·¯å¾„æ“ä½œ
- `std::thread`, `std::mutex` æ›¿ä»£å¹³å°çº¿ç¨‹ API
- `std::byte` ç±»å‹æ›´å®‰å…¨

---

### 8.2 Windows API ä¾èµ–ç»Ÿè®¡

å½“å‰é¡¹ç›®å…±æœ‰ **368 å¤„** Windows API è°ƒç”¨ï¼Œåˆ†å¸ƒå¦‚ä¸‹ï¼š

```
Windows API è°ƒç”¨çƒ­ç‚¹åˆ†å¸ƒ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ImageTable.cpp          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 44 (PEæ–‡ä»¶è§£æ)
MemoryMappedResults.cpp â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  43 (å†…å­˜æ˜ å°„)
TimestampExtractor.cpp  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          23 (æ—¶é—´æˆ³)
UsnJournalReader.cpp    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ           22 (USNæ—¥å¿—)
FileCarver.cpp          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ           28 (ç£ç›˜æ‰«æ)
MFTStructures.h         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                17 (NTFSç»“æ„)
MFTReader.cpp           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                 16 (MFTè¯»å–)
DeletedFileScanner.cpp  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                  14 (åˆ é™¤æ‰«æ)
å…¶ä»–æ–‡ä»¶                â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 161
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

#### ä¸»è¦ä¾èµ–ç±»å‹

| API ç±»å‹ | è°ƒç”¨æ¬¡æ•° | è·¨å¹³å°æ›¿ä»£æ–¹æ¡ˆ |
|----------|---------|---------------|
| `HANDLE/CreateFile` | ~50 | `open()` / `fopen()` |
| `DWORD/ULONGLONG` | ~120 | `uint32_t` / `uint64_t` |
| `FILETIME` | ~45 | `time_t` / `timespec` |
| `DeviceIoControl` | ~15 | `ioctl()` |
| `MapViewOfFile` | ~20 | `mmap()` |
| `CreateFileMapping` | ~10 | `shm_open()` |
| `CriticalSection` | ~8 | `std::mutex` |

---

### 8.3 æ–‡ä»¶è·¨å¹³å°ç§»æ¤éš¾åº¦è¯„ä¼°

#### éš¾åº¦ç­‰çº§è¯´æ˜

| ç­‰çº§ | ç¬¦å· | å«ä¹‰ | é¢„è®¡å·¥æ—¶ |
|------|------|------|---------|
| ç®€å• | ğŸŸ¢ | çº¯ç®—æ³•/å°‘é‡é€‚é… | < 1å¤© |
| ä¸­ç­‰ | ğŸŸ¡ | éœ€æŠ½è±¡å±‚å°è£… | 1-3å¤© |
| å›°éš¾ | ğŸ”´ | æ·±åº¦å¹³å°ä¾èµ– | 3-7å¤© |
| é‡å†™ | âš« | éœ€é’ˆå¯¹æ–°FSé‡æ–°å®ç° | > 1å‘¨ |

---

#### ğŸ“ Core æ¨¡å— (652 è¡Œ)

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| Main.cpp | 102 | ğŸŸ¢ | 1 | `Windows.h` ç±»å‹ï¼Œæ”¹ç”¨æ ‡å‡†ç±»å‹å³å¯ |
| cli.cpp | 304 | ğŸŸ¡ | 4 | æ§åˆ¶å°é¢œè‰²ã€å®½å­—ç¬¦å¤„ç†éœ€é€‚é… |
| cli.h | 43 | ğŸŸ¢ | 1 | ä»…å¤´æ–‡ä»¶åŒ…å« |
| climodule.cpp | 157 | ğŸŸ¡ | 3 | `LoadLibrary` â†’ `dlopen` |
| climodule.h | 46 | ğŸŸ¢ | 1 | ä»…å¤´æ–‡ä»¶åŒ…å« |

**æ¨¡å—è¯„ä¼°**: ğŸŸ¡ ä¸­ç­‰ - ä¸»è¦æ˜¯ DLL åŠ è½½æœºåˆ¶éœ€è¦é€‚é…

---

#### ğŸ“ Commands æ¨¡å— (3,234 è¡Œ)

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| cmd.cpp | 2,931 | ğŸŸ¡ | 7 | å‘½ä»¤è°ƒç”¨åº•å±‚æ¨¡å—ï¼Œä¾èµ–ä¼ é€’ |
| cmd.h | 143 | ğŸŸ¢ | 1 | ä»… `Windows.h` ç±»å‹ |
| CommandMacros.h | 160 | ğŸŸ¢ | 1 | çº¯å®å®šä¹‰ï¼Œå¯ç§»æ¤ |

**æ¨¡å—è¯„ä¼°**: ğŸŸ¡ ä¸­ç­‰ - è‡ªèº«ä¾èµ–å°‘ï¼Œä½†è°ƒç”¨çš„åº•å±‚æ¨¡å—éœ€å…ˆç§»æ¤

---

#### ğŸ“ FileRestore æ¨¡å— (11,370 è¡Œ)

##### MFT è¯»å–å±‚ (2,081 è¡Œ) - âš« éœ€é‡å†™

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| **MFTReader.cpp** | 637 | âš« | 16 | `CreateFile` + `DeviceIoControl` ç›´æ¥è®¿é—® NTFS |
| MFTReader.h | 89 | âš« | 14 | NTFS ç‰¹å®šç»“æ„å®šä¹‰ |
| **MFTParser.cpp** | 560 | âš« | 4 | è§£æ NTFS MFT è®°å½•ç»“æ„ |
| MFTParser.h | 32 | âš« | 1 | NTFS ç‰¹å®šæ¥å£ |
| MFTBatchReader.cpp | 165 | ğŸ”´ | - | ä¾èµ– MFTReader |
| MFTBatchReader.h | 64 | ğŸ”´ | 4 | ä¾èµ– MFTReader |
| **MFTStructures.h** | 137 | âš« | 17 | å®Œå…¨ NTFS ç‰¹å®šç»“æ„ |
| PathResolver.cpp | 382 | ğŸ”´ | 4 | ä¾èµ– MFT è§£æ |
| PathResolver.h | 63 | ğŸ”´ | 1 | ä¾èµ– MFT è§£æ |

**å­æ¨¡å—è¯„ä¼°**: âš« **éœ€å®Œå…¨é‡å†™** - è¿™æ˜¯ NTFS ä¸“ç”¨ä»£ç ï¼Œç§»æ¤åˆ° ext4/APFS éœ€è¦é‡æ–°å®ç°

---

##### æ–‡ä»¶æ¢å¤å±‚ (1,256 è¡Œ) - ğŸ”´ å›°éš¾

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| FileRestore.cpp | 271 | ğŸ”´ | 4 | åè°ƒå±‚ï¼Œä¾èµ– MFT æ¨¡å— |
| FileRestore.h | 59 | ğŸ”´ | 1 | ä¾èµ– MFT ç±»å‹ |
| DeletedFileScanner.cpp | 861 | ğŸ”´ | 14 | æ·±åº¦ä¾èµ– MFT æ‰«æ |
| DeletedFileScanner.h | 65 | ğŸ”´ | 1 | ä¾èµ– MFT ç±»å‹ |

**å­æ¨¡å—è¯„ä¼°**: ğŸ”´ å›°éš¾ - éœ€è¦ä¸ºæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿå®ç°ä¸åŒçš„æ‰«æé€»è¾‘

---

##### è¦†ç›–æ£€æµ‹å±‚ (1,614 è¡Œ) - ğŸ”´ å›°éš¾

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| OverwriteDetector.cpp | 1,251 | ğŸ”´ | 12 | ç°‡çº§åˆ«æ“ä½œï¼Œä¾èµ– MFT |
| OverwriteDetector.h | 147 | ğŸ”´ | 2 | ä¾èµ– MFT ç±»å‹ |
| OverwriteDetectionThreadPool.cpp | 149 | ğŸŸ¡ | - | çº¿ç¨‹æ± å¯å¤ç”¨ |
| OverwriteDetectionThreadPool.h | 67 | ğŸŸ¡ | 1 | `std::thread` å·²è·¨å¹³å° |

**å­æ¨¡å—è¯„ä¼°**: ğŸ”´ å›°éš¾ - æ ¸å¿ƒé€»è¾‘ä¾èµ– NTFS ç°‡åˆ†é…æœºåˆ¶

---

##### USN æ—¥å¿— (562 è¡Œ) - âš« Windows ä¸“å±

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| **UsnJournalReader.cpp** | 452 | âš« | 22 | USN Journal æ˜¯ Windows NTFS ä¸“å±åŠŸèƒ½ |
| UsnJournalReader.h | 110 | âš« | 14 | å®Œå…¨ Windows ä¸“å± |

**å­æ¨¡å—è¯„ä¼°**: âš« **æ— æ³•ç§»æ¤** - USN Journal æ˜¯ Windows ç‹¬æœ‰åŠŸèƒ½
- Linux æ›¿ä»£: `inotify` / `fanotify` (å®æ—¶ç›‘æ§ï¼Œéå†å²æ—¥å¿—)
- macOS æ›¿ä»£: `FSEvents`

---

##### ç­¾åæœç´¢ (4,824 è¡Œ) - ğŸŸ¡ å¤§éƒ¨åˆ†å¯ç§»æ¤

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| FileCarver.cpp | 1,886 | ğŸŸ¡ | 28 | æ ¸å¿ƒç®—æ³•å¯ç§»æ¤ï¼Œç£ç›˜ I/O éœ€é€‚é… |
| FileCarver.h | 301 | ğŸŸ¡ | 2 | æ•°æ®ç»“æ„å¯ç§»æ¤ |
| CarvedFileTypes.h | 60 | ğŸŸ¢ | 4 | ä»… `FILETIME`ï¼Œå¯æ›¿æ¢ä¸º `time_t` |
| **SignatureScanThreadPool.cpp** | 547 | ğŸŸ¢ | 3 | ä½¿ç”¨ `std::thread`ï¼Œå·²è·¨å¹³å° |
| SignatureScanThreadPool.h | 195 | ğŸŸ¢ | 1 | ä½¿ç”¨ C++11 çº¿ç¨‹ |
| MFTLCNIndex.cpp | 366 | ğŸ”´ | 4 | LCN æ˜ å°„æ˜¯ NTFS æ¦‚å¿µ |
| MFTLCNIndex.h | 70 | ğŸ”´ | 5 | ä¾èµ– NTFS |
| **TimestampExtractor.cpp** | 532 | ğŸŸ¡ | 23 | è§£æç®—æ³•å¯ç§»æ¤ï¼Œ`FILETIME` éœ€é€‚é… |
| TimestampExtractor.h | 60 | ğŸŸ¡ | 13 | `FILETIME` â†’ `timespec` |
| **FileIntegrityValidator.cpp** | 685 | ğŸŸ¢ | 10 | **çº¯ç®—æ³•**ï¼Œç†µè®¡ç®—ã€CRC å®Œå…¨å¯ç§»æ¤ |
| FileIntegrityValidator.h | 149 | ğŸŸ¢ | 5 | ä»…ç±»å‹å®šä¹‰ |

**å­æ¨¡å—è¯„ä¼°**: ğŸŸ¡ ä¸­ç­‰ - **ç­¾ååŒ¹é…ç®—æ³•æ˜¯è·¨å¹³å°çš„æ ¸å¿ƒèµ„äº§**

---

##### å¤§æ•°æ®é›†ä¼˜åŒ– (958 è¡Œ) - ğŸŸ¡ ä¸­ç­‰

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| CarvedResultsCache.cpp | 413 | ğŸŸ¡ | 8 | æ–‡ä»¶ I/Oï¼Œå¯ç”¨ `fstream` æ›¿ä»£ |
| CarvedResultsCache.h | 75 | ğŸŸ¡ | 5 | ç±»å‹é€‚é… |
| MemoryMappedResults.cpp | 398 | ğŸŸ¡ | 43 | `MapViewOfFile` â†’ `mmap()` |
| MemoryMappedResults.h | 72 | ğŸŸ¡ | 3 | æ¥å£å¯ç»Ÿä¸€ |

**å­æ¨¡å—è¯„ä¼°**: ğŸŸ¡ ä¸­ç­‰ - å†…å­˜æ˜ å°„æœ‰ POSIX ç­‰ä»·ç‰©

---

#### ğŸ“ Utils æ¨¡å— (948 è¡Œ) - ğŸŸ¢ å¤§éƒ¨åˆ†ç®€å•

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| Logger.cpp | 272 | ğŸŸ¡ | 4 | `CriticalSection` â†’ `std::mutex` |
| Logger.h | 115 | ğŸŸ¡ | 1 | çº¿ç¨‹å®‰å…¨é€‚é… |
| LocalizationManager.cpp | 187 | ğŸŸ¢ | - | çº¯æ–‡ä»¶è¯»å– |
| LocalizationManager.h | 70 | ğŸŸ¢ | 1 | ä»…å¤´æ–‡ä»¶ |
| ProgressBar.cpp | 119 | ğŸŸ¡ | - | æ§åˆ¶å°è¾“å‡ºé€‚é… |
| ProgressBar.h | 44 | ğŸŸ¢ | 1 | ä»…å¤´æ–‡ä»¶ |
| CrashHandler.cpp | 116 | ğŸ”´ | 4 | `SetUnhandledExceptionFilter` Windows ä¸“å± |
| CrashHandler.h | 25 | ğŸ”´ | 1 | ä¿¡å·å¤„ç†éœ€é‡å†™ |

**æ¨¡å—è¯„ä¼°**: ğŸŸ¢ ç®€å• - å¤§éƒ¨åˆ†å¯ç›´æ¥ç§»æ¤æˆ–æœ‰ç®€å•æ›¿ä»£

---

#### ğŸ“ Analysis æ¨¡å— (378 è¡Œ) - âš« Windows ä¸“å±

| æ–‡ä»¶ | è¡Œæ•° | éš¾åº¦ | Windows API | ç§»æ¤è¯´æ˜ |
|------|------|------|-------------|----------|
| ImageTable.cpp | 339 | âš« | 44 | PE æ–‡ä»¶æ ¼å¼è§£æï¼ŒWindows ä¸“å± |
| ImageTable.h | 39 | âš« | 4 | PE æ ¼å¼å®šä¹‰ |

**æ¨¡å—è¯„ä¼°**: âš« **Windows ä¸“å±** - PE åˆ†æåŠŸèƒ½ï¼ŒLinux/macOS éœ€æ”¹ä¸º ELF/Mach-O è§£æ

---

### 8.4 è·¨å¹³å°ç§»æ¤æ€»ç»“

#### ä»£ç å¯ç§»æ¤æ€§ç»Ÿè®¡

```
è·¨å¹³å°ç§»æ¤éš¾åº¦åˆ†å¸ƒ (æŒ‰ä»£ç è¡Œæ•°):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŸ¢ ç®€å• (å¯ç›´æ¥ç§»æ¤)      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ           2,847 è¡Œ (17.1%)
ğŸŸ¡ ä¸­ç­‰ (éœ€æŠ½è±¡å±‚)        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   5,521 è¡Œ (33.2%)
ğŸ”´ å›°éš¾ (éœ€å¤§é‡é‡å†™)      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       4,127 è¡Œ (24.9%)
âš« éœ€å®Œå…¨é‡å†™/ä¸“å±        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       4,108 è¡Œ (24.7%)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                                     æ€»è®¡: 16,603 è¡Œ
```

#### å¯å¤ç”¨èµ„äº§ (çº¦ 8,368 è¡Œ / 50.4%)

1. **å®Œå…¨å¯å¤ç”¨ (ğŸŸ¢ 2,847 è¡Œ)**
   - `FileIntegrityValidator` - ç†µè®¡ç®—ã€ç»“æ„éªŒè¯
   - `SignatureScanThreadPool` - å¹¶è¡Œæ‰«ææ¡†æ¶
   - `CommandMacros.h` - å‘½ä»¤æ³¨å†Œæœºåˆ¶
   - `LocalizationManager` - å›½é™…åŒ–

2. **é€‚é…åå¯å¤ç”¨ (ğŸŸ¡ 5,521 è¡Œ)**
   - `FileCarver` æ ¸å¿ƒç®—æ³• - ç­¾ååŒ¹é…ã€æ–‡ä»¶å¤§å°ä¼°ç®—
   - `TimestampExtractor` - å…ƒæ•°æ®è§£æï¼ˆEXIF, PDF, ZIPï¼‰
   - `CarvedResultsCache` / `MemoryMappedResults` - ç¼“å­˜æœºåˆ¶
   - `Logger` / `ProgressBar` - è¾…åŠ©åŠŸèƒ½

#### éœ€é‡æ–°å®ç° (çº¦ 8,235 è¡Œ / 49.6%)

1. **æ–‡ä»¶ç³»ç»Ÿä¸“å±ä»£ç  (âš« 4,108 è¡Œ)**
   - MFT è¯»å–å’Œè§£æ â†’ ext4: superblock/inode, APFS: container/volume
   - USN Journal â†’ inotify/FSEvents
   - PE æ–‡ä»¶åˆ†æ â†’ ELF/Mach-O

2. **å¹³å°é€‚é…ä»£ç  (ğŸ”´ 4,127 è¡Œ)**
   - ç£ç›˜åŸå§‹è®¿é—® â†’ `/dev/sdX` æˆ– `/dev/diskN`
   - è¦†ç›–æ£€æµ‹é€»è¾‘ â†’ éœ€ç†è§£ç›®æ ‡ FS çš„åˆ†é…ç­–ç•¥

---

### 8.5 æ¨èçš„è·¨å¹³å°æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Platform Abstraction Layer                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Windows   â”‚  â”‚    Linux    â”‚  â”‚    macOS    â”‚          â”‚
â”‚  â”‚   (NTFS)    â”‚  â”‚   (ext4)    â”‚  â”‚   (APFS)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                â”‚                â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              IFileSystemReader (æ¥å£)                  â”‚  â”‚
â”‚  â”‚  - OpenVolume(path)                                    â”‚  â”‚
â”‚  â”‚  - ReadClusters(lcn, count) / ReadBlocks(...)         â”‚  â”‚
â”‚  â”‚  - GetDeletedFiles()                                   â”‚  â”‚
â”‚  â”‚  - GetFileMetadata(id)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Cross-Platform Core                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ FileCarver   â”‚ â”‚ Integrity    â”‚ â”‚ SignatureScan     â”‚    â”‚
â”‚  â”‚ (ç­¾åæ‰«æ)   â”‚ â”‚ Validator    â”‚ â”‚ ThreadPool        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Timestamp    â”‚ â”‚ Results      â”‚ â”‚ Progress/Logger   â”‚    â”‚
â”‚  â”‚ Extractor    â”‚ â”‚ Cache        â”‚ â”‚                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¨èçš„æ–‡ä»¶ç³»ç»ŸæŠ½è±¡æ¥å£

```cpp
// è·¨å¹³å°æ–‡ä»¶ç³»ç»Ÿè¯»å–æ¥å£
class IFileSystemReader {
public:
    virtual ~IFileSystemReader() = default;

    // åŸºç¡€æ“ä½œ
    virtual bool Open(const std::string& device) = 0;
    virtual void Close() = 0;

    // å—/ç°‡è¯»å–
    virtual bool ReadBlocks(uint64_t blockNum, uint64_t count,
                           std::vector<uint8_t>& data) = 0;

    // æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯
    virtual uint64_t GetBlockSize() const = 0;
    virtual uint64_t GetTotalBlocks() const = 0;
    virtual std::string GetFileSystemType() const = 0;

    // å·²åˆ é™¤æ–‡ä»¶æ‰«æ
    virtual std::vector<DeletedFileInfo> ScanDeletedFiles() = 0;

    // å…ƒæ•°æ®è·å–
    virtual FileMetadata GetFileMetadata(uint64_t fileId) = 0;
};

// å„å¹³å°å®ç°
class NTFSReader : public IFileSystemReader { /* ... */ };
class Ext4Reader : public IFileSystemReader { /* ... */ };
class APFSReader : public IFileSystemReader { /* ... */ };
```

---

### 8.6 è·¨å¹³å°ç§»æ¤è·¯çº¿å›¾

#### Phase 1: æŠ½è±¡å±‚å»ºç«‹ (é¢„è®¡ 2-3 å‘¨)

```
â–¡ å®šä¹‰ IFileSystemReader æ¥å£
â–¡ æå–å¹³å°æ— å…³ä»£ç åˆ° core/ ç›®å½•
â–¡ åˆ›å»ºç±»å‹åˆ«å (uint64_t æ›¿ä»£ ULONGLONG)
â–¡ æ›¿æ¢ FILETIME ä¸º std::chrono
â–¡ è¿ç§»åˆ° std::filesystem
```

#### Phase 2: Linux/ext4 æ”¯æŒ (é¢„è®¡ 4-6 å‘¨)

```
â–¡ å®ç° Ext4Reader
  â–¡ è§£æ superblock
  â–¡ è¯»å– inode è¡¨
  â–¡ éå†ç›®å½•ç»“æ„
  â–¡ è¯†åˆ«å·²åˆ é™¤æ–‡ä»¶ (æ£€æŸ¥ inode æ ‡å¿—)
â–¡ é€‚é… FileCarver çš„ç£ç›˜ I/O
â–¡ å†…å­˜æ˜ å°„æ”¹ç”¨ mmap()
â–¡ CrashHandler æ”¹ç”¨ signal()
```

#### Phase 3: macOS/APFS æ”¯æŒ (é¢„è®¡ 4-6 å‘¨)

```
â–¡ å®ç° APFSReader
  â–¡ è§£æ container superblock
  â–¡ è¯»å– object map
  â–¡ éå† B-tree ç»“æ„
â–¡ å¤„ç† APFS åŠ å¯†å·
â–¡ FSEvents é›†æˆï¼ˆæ›¿ä»£ USN Journalï¼‰
```

#### Phase 4: ç»Ÿä¸€æ„å»ºç³»ç»Ÿ (é¢„è®¡ 1-2 å‘¨)

```
â–¡ CMake è·¨å¹³å°æ„å»º
â–¡ CI/CD å¤šå¹³å°æµ‹è¯•
â–¡ æ‰“åŒ…è„šæœ¬ (deb/rpm/dmg)
```

---

### 8.7 å‚è€ƒèµ„æº

#### æ–‡ä»¶ç³»ç»Ÿæ–‡æ¡£
- **ext4**: https://www.kernel.org/doc/html/latest/filesystems/ext4/
- **APFS**: Apple File System Reference (éœ€ Apple å¼€å‘è€…è´¦å·)
- **NTFS**: https://flatcap.github.io/linux-ntfs/

#### è·¨å¹³å°åº“æ¨è
- **ç£ç›˜ I/O**: libblkid (Linux), DiskArbitration.framework (macOS)
- **å†…å­˜æ˜ å°„**: Boost.Interprocess
- **çº¿ç¨‹æ± **: Intel TBB, cpp-taskflow

---

## ä¹ã€ç›¸å…³æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| æœºå™¨å­¦ä¹ åˆ†æ | `MACHINE_LEARNING_ANALYSIS.md` | MLåœ¨æ•°æ®æ¢å¤ä¸­çš„å¯è¡Œæ€§åˆ†æã€æ•°å­¦åŸºç¡€ã€åº“æ¨è |
| USNæ—¥å¿—å®ç° | `USN_JOURNAL_IMPLEMENTATION.md` | USN Journal åŠŸèƒ½è¯¦è§£ |
| çº¿ç¨‹æ± åˆ†æ | `SIGNATURE_SCAN_THREADPOOL_ANALYSIS.md` | ç­¾åæ‰«æçº¿ç¨‹æ± è®¾è®¡ |
| å®Œæ•´æ€§éªŒè¯ | `FILE_INTEGRITY_VALIDATION.md` | æ–‡ä»¶å®Œæ•´æ€§éªŒè¯ç®—æ³• |
| è¯­è¨€è¿ç§»åˆ†æ | `LANGUAGE_MIGRATION_ANALYSIS.md` | è·¨è¯­è¨€è¿ç§»è¯„ä¼° |

---

*æŠ¥å‘Šç”± Claude Code è‡ªåŠ¨ç”Ÿæˆï¼Œæœ€åæ›´æ–°: 2026-01-06*
